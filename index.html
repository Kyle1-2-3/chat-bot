<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>School Chatbot</title>

  <style>
    body {
      font-family: Arial;
      padding: 20px;
      background-color: #000;
      color: #fff;
      font-size: 18px;
    }

    #chat {
      width: 100%;
      height: 300px;
      border: 1px solid #444;
      overflow-y: auto;
      padding: 10px;
      background-color: #111;
      border-radius: 8px;
      margin-bottom: 12px;
    }

    textarea {
      width: 100%;
      padding: 10px;
      font-size: 18px;
      background-color: #222;
      color: #fff;
      border: 1px solid #555;
      border-radius: 6px;
      resize: none;
    }

    button {
      margin-top: 8px;
      padding: 10px 16px;
      font-size: 18px;
      background-color: #333;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    button:disabled {
      background-color: #555;
      cursor: not-allowed;
    }

    #charCount {
      margin-top: 4px;
      font-size: 14px;
      color: #aaa;
      text-align: right;
    }

    #charCount.warning {
      color: red;
    }
  </style>
</head>

<body>
  <h2>School Chatbot Demo</h2>

  <div id="chat"></div>


  <textarea id="msg" rows="3" placeholder="Ask something..."></textarea>

  <div id="charCount">0 / 200</div>

  <button id="sendBtn">Send</button>

  <script>
    const input = document.getElementById("msg");
    const chat = document.getElementById("chat");
    const counter = document.getElementById("charCount");
    const sendBtn = document.getElementById("sendBtn");

    const MAX_CHARS = 200;

    // ì´ˆê¸° ìƒíƒœ
    sendBtn.disabled = true;

    // ðŸ”¢ ì‹¤ì‹œê°„ ê¸€ìž ìˆ˜ ì¹´ìš´íŠ¸
    input.addEventListener("input", () => {
      if (input.value.length > MAX_CHARS) {
        input.value = input.value.slice(0, MAX_CHARS);
      }

      const len = input.value.length;
      counter.textContent = `${len} / ${MAX_CHARS}`;

      if (len >= MAX_CHARS) {
        counter.classList.add("warning");
      } else {
        counter.classList.remove("warning");
      }

      sendBtn.disabled = (len === 0);
    });

    // âŒ¨ï¸ Enterë¡œ ì „ì†¡ (Shift+EnterëŠ” ì¤„ë°”ê¿ˆ)
    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        send();
      }
    });

    async function send() {
      const message = input.value.trim();
      if (!message) return;

      if (message.length > MAX_CHARS) {
        alert("Input cannot exceed 200 characters.");
        return;
      }

      // ìž…ë ¥ ì´ˆê¸°í™”
      input.value = "";
      counter.textContent = `0 / ${MAX_CHARS}`;
      counter.classList.remove("warning");
      sendBtn.disabled = true;

      // XSS-safe ì¶œë ¥
      const me = document.createElement("p");
      me.textContent = `Me: ${message}`;
      chat.appendChild(me);

      const res = await fetch("/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message })
      });

      const data = await res.json();

      const bot = document.createElement("p");
      bot.textContent = `Bot: ${data.reply}`;
      chat.appendChild(bot);

      chat.scrollTop = chat.scrollHeight;
    }
  </script>
</body>
</html>